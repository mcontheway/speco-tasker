# 功能规格：Task Master AI 功能移除重构

**功能分支** : `001-task-master-ai-removal`
**创建时间** : 2025年09月15日
**状态** : 草稿
**输入** : 用户描述: "Task Master 项目改造需求文档 - 移除所有AI相关功能，专注于提供纯粹的手动任务管理能力"

## 执行流程（主流程）

```
1. 分析当前系统架构和AI功能分布
   → 识别 11 个涉及AI的功能模块（基于现有调研报告）
   → 识别 27 个纯手动功能模块和1个混合模式功能
2. 制定AI功能移除计划
   → 确定移除范围：AI服务调用、功能模块、配置和依赖
   → 确定保留范围：核心任务管理、手动更新功能、标签管理等
3. 执行AI功能移除
   → 移除所有 generateObjectService 和 generateTextService 调用
   → 移除 parse-prd、update系列、expand系列等AI功能模块
   → 移除AI模型配置和Perplexity AI集成
4. 处理混合模式功能优化
   → 简化 add-task 功能，完全移除AI自动生成逻辑
   → 优化 update-task 和 update-subtask 的手动更新功能
5. 简化系统架构
   → 清理AI服务相关依赖包
   → 移除AI相关环境变量配置
   → 移除AI服务初始化代码
6. 验证系统完整性
   → 确保所有保留功能正常工作（27个纯手动功能）
   → 验证向后兼容性，保持现有数据格式
   → 确认系统性能优化
7. 更新文档和配置
   → 更新相关文档
   → 基于调研结果调整配置文件格式
8. 返回：成功（AI功能移除完成，系统专注于手动任务管理）
```

* * *

## ⚡ 快速指南

*   ✅ 关注用户需要纯粹的手动任务管理能力
*   ❌ 避免保留任何AI辅助功能
*   👥 面向需要可预测、稳定任务管理工具的用户

## 用户场景与测试 *(强制)*

### 主要用户故事

作为 Task Master 用户，我希望系统移除所有AI功能，只保留纯粹的手动任务管理能力，以便获得更稳定、可预测的任务管理体验，不再依赖外部AI服务，同时保持完整的手动更新和字段扩展能力。

### 验收场景

1.  **给定** 系统包含38个功能模块，其中11个涉及AI调用， **当** 执行AI功能移除重构， **则** 系统只保留27个纯手动功能和1个混合模式功能，AI功能完全移除
2.  **给定** 用户使用add-task功能时， **当** 系统完成重构， **则** 用户只能通过手动参数创建任务，不能使用AI自动生成
3.  **给定** 系统当前支持update-task和update-subtask的手动更新功能， **当** 完成重构， **则** 这些手动更新功能完整保留，支持字段覆盖和头部添加模式

### 边界情况

*   当系统检测到AI服务调用时会发生什么？→ 所有AI调用应被完全移除，不留残余代码
*   系统如何处理原来依赖AI功能的用户工作流？→ 需要用户适应纯手动操作模式，但保留所有手动功能
*   当移除操作影响间接依赖功能时会发生什么？→ 必须确保不破坏现有纯手动功能
*   当用户习惯于使用AI辅助功能时会发生什么？→ 提供清晰的迁移指导，帮助用户适应纯手动模式

## 需求 *(必须)*

### 功能需求

*   **FR-001**: 系统必须移除所有 generateObjectService 调用
*   **FR-002**: 系统必须移除所有 generateTextService 调用
*   **FR-003**: 系统必须移除 parse-prd 功能（PRD解析功能）
*   **FR-004**: 系统必须移除 update 系列功能（update, update-task, update-subtask）的AI调用部分，保留手动更新逻辑
*   **FR-005**: 系统必须移除 expand 和 expand-all 功能
*   **FR-006**: 系统必须移除 analyze-complexity 功能
*   **FR-007**: 系统必须移除 research 功能
*   **FR-008**: 系统必须移除 scope-up 和 scope-down 功能
*   **FR-009**: 系统必须保留所有核心任务管理功能（get-tasks, get-task, next-task, set-status, move-task, remove-task）
*   **FR-010**: 系统必须保留所有子任务管理功能（add-subtask, remove-subtask, clear-subtasks）
*   **FR-011**: 系统必须保留依赖关系管理功能（add-dependency, remove-dependency, validate-dependencies, fix-dependencies）
*   **FR-012**: 系统必须保留标签管理功能（add-tag, delete-tag, list-tags, use-tag, rename-tag, copy-tag）
*   **FR-013**: 系统必须保留文件和报告功能（generate, complexity-report, sync-readme）
*   **FR-014**: 系统必须保留系统管理功能（init, migrate, models, rules, lang）
*   **FR-015**: 系统必须简化 add-task 功能，完全移除AI自动生成逻辑，只保留手动参数创建
*   **FR-016**: 系统必须保留 update-task 和 update-subtask 的手动更新功能，支持字段覆盖和头部添加模式
*   **FR-017**: 系统必须移除所有AI模型配置相关功能
*   **FR-018**: 系统必须移除 Perplexity AI 集成
*   **FR-019**: 系统必须清理AI服务相关依赖包
*   **FR-020**: 系统必须移除AI相关环境变量配置
*   **FR-021**: 系统必须移除AI服务初始化代码
*   **FR-022**: 系统必须保持现有任务数据的完全兼容性
*   **FR-023**: 系统必须保持配置文件格式的兼容性
*   **FR-024**: 系统必须保持API接口的向后兼容性

### 关键实体 *(如果功能涉及数据，请包含)*

*   **任务实体**: 代表用户需要管理的工作项，包含id、title、description、status、dependencies、priority、details、testStrategy、subtasks等标准字段
*   **标签实体**: 代表任务的分类和上下文隔离，允许用户在不同场景下管理任务
*   **依赖关系实体**: 定义任务之间的执行顺序关系，确保任务按正确顺序完成
*   **更新日志实体**: 记录任务和子任务的手动更新历史，支持字段覆盖和头部添加两种模式

* * *

## 现有调研报告整合

### 功能分析调研（task-master-manual-mode-report.md）

基于现有调研，系统包含38个功能模块的详细分析：
- **纯手动功能（27个）**：完全不调用AI，可放心使用的核心功能
- **混合模式功能（1个）**：add-task功能支持手动参数跳过AI
- **完全AI功能（10个）**：必须移除的AI依赖功能

### Update功能调研（task-master-update-feature-research-report.md）

Update系列功能详细机制：
- **update命令**：批量智能修改多个任务
- **update-task命令**：修改单个任务，支持字段覆盖和append模式
- **update-subtask命令**：为子任务添加时间戳日志
- **移除AI后的影响**：保留手动更新逻辑，移除AI调用部分

* * *

## 评审与验收清单

*GATE：在 main()执行期间运行自动检查*

### 内容质量

- [x] 不涉及具体实现细节（语言、框架、API）
- [x] 专注于用户价值和业务需求
- [x] 为非技术利益相关者编写
- [x] 所有必填部分已完成

### 需求完整性

- [x] 没有[需要澄清]标记剩余
- [x] 需求是可测试且无歧义的
- [x] 成功标准是可衡量的
- [x] 范围明确界定
- [x] 识别了依赖关系和假设

### 调研报告整合

- [x] 功能分析调研已整合（27个纯手动功能确认保留）
- [x] Update功能调研已整合（手动更新逻辑保留）

* * *

## 执行状态

*在处理过程中由 main() 更新*

- [x] 用户描述已解析
- [x] 关键概念已提取
- [x] 标记的歧义
- [x] 定义的用户场景
- [x] 生成的需求
- [x] 识别的实体
- [x] 调研报告已整合
- [x] 审查清单已通过

* * *
