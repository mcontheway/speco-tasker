# 功能规格：品牌重塑与AI功能移除

**功能分支** : `002-feature-description-ai-taskmaster-speco`
**创建时间** : 2025年1月15日
**状态** : 评审完成，准备规划
**输入** : 用户描述: "品牌重塑与AI功能移除：将默认路径从.taskmaster/修改为.speco/，将命令名称从task-master改为speco-tasker，识别并移除所有残留AI实现、文档、配置，并在所有用户界面中不再包含task master品牌信息，并通过配置文件管理文件目录以避免变动风险。"

---

**📋 规范完善总结**

经过第三方专家评审和调整，本规范已显著改进：

✅ **新增功能需求**: FR-010至FR-012，解决package.json冲突和时序协调问题
✅ **量化验收标准**: 6个验收场景全部包含具体可测量指标
✅ **完整边界情况**: 补充10个技术边界情况，包括跨平台兼容性
✅ **实施阶段划分**: 4阶段逐步执行，避免风险集中爆发
✅ **技术风险评估**: 高/中/低风险分类，制定针对性缓解策略
✅ **AI影响评估**: 准确识别187个文件的影响范围

**关键改进点**：
- **解决了package.json bin字段冲突的关键问题**
- **将AI清理复杂度从"简单清理"调整为"187文件渐进式清理"**
- **验收标准从定性描述改为量化指标**（如"0个文件包含旧品牌信息"）
- **增加了多平台兼容性和配置文件权限等技术细节**
- **关键时序调整**：FR-012（文件重命名时序协调）前置到阶段一，作为基础设施保障
- **依赖关系明确化**：FR-003、FR-010、FR-007/008等功能对FR-012的强依赖关系

---

## 执行流程（主流程）

```
1. 从输入中解析用户描述
   → 功能描述完整且明确，无需澄清
2. 从描述中提取关键概念
   → 参与者：开发者和用户
   → 操作：路径配置化、命令重命名、AI清理、品牌统一
   → 数据：配置文件、路径映射、品牌配置、依赖关系图
   → 约束条件：保持功能完整性、无向后兼容要求、正确的实施顺序
3. 对于每个不明确的方面：
   → 所有方面都已明确，无需标记澄清
4. 重新评估实施顺序和复杂度
   → 阶段一：建立路径配置系统和package.json清理
   → 阶段二：在配置中设置.speco/路径和命令重命名
   → 阶段三：AI内容清理（187个文件，渐进式策略）
   → 阶段四：品牌信息统一和完整性验证
5. 评估受影响的功能模块和技术风险
   → 初始化功能：需要重构配置系统
   → 迁移功能：需要更新路径处理
   → 文件操作：全部需要配置化
   → 测试套件：需要调整AI相关测试
   → package.json：需要清理bin字段冲突
6. 建立AI内容影响评估
   → 识别187个文件中的AI相关内容
   → 建立依赖关系图
   → 制定渐进式清理策略
7. 填写用户场景与测试部分
   → 用户场景清晰：开发者建立可配置的路径系统
8. 生成功能需求（扩展到12个）
   → 每个需求都可测试且明确，包括量化指标
9. 识别关键实体（扩展到8个）
10. 完善验收标准（6个量化场景）
11. 运行审查清单
    → 无[需要澄清]标记
    → 无实现细节
12. 返回：成功（规范已准备好进行规划）
```

* * *

## ⚡ 快速指南

*   ✅ 关注用户需要什么以及为什么：品牌统一和代码清理
*   ❌ 避免实现方式：不涉及具体的技术栈实现
*   👥 面向商业利益相关者：开发者和维护者
*   🎯 核心价值：产品品牌一致性和代码质量提升

### 章节要求

*   **必填章节** ：每个功能都必须完成
*   **可选章节** ：仅在相关时包含
*   当一个部分不适用时，请完全删除它

### 用于 AI 生成

当从用户提示创建此规范时：

1.  **标记所有模糊之处** ：本规范中无模糊内容
2.  **不要猜测** ：所有需求都已明确说明
3.  **像测试人员一样思考** ：每个需求都可通过测试验证
4.  **常见的未明确说明的领域** ：
    *   ✅ 用户类型和权限：开发者/维护者
    *   ✅ 数据保留/删除政策：清理AI相关内容
    *   ✅ 性能目标与规模：不涉及性能要求
    *   ✅ 错误处理行为：功能完整性保障
    *   ✅ 集成要求：CLI和MCP界面统一
    *   ✅ 安全/合规需求：不涉及安全要求

* * *

## 用户场景与测试 *(强制)*

### 主要用户故事

**作为** Speco Tasker 的开发者/维护者，
**我希望** 建立一个可配置的路径管理系统，然后在此基础上完成品牌重塑，
**以便** 避免重复修改、降低遗漏风险，并实现真正的路径灵活性。

### 验收场景

1.  **给定** 硬编码的路径系统， **当** 开发者建立路径配置， **则** 所有路径都可以通过配置文件管理，且配置文件不存在时自动使用默认配置
2.  **给定** 路径配置文件， **当** 设置为 `.speco/`， **则** 整个系统自动使用新的路径结构，且所有文件操作正确指向新路径
3.  **给定** 现有的 CLI 命令， **当** 用户运行命令， **则** ：
   - 所有 `--help` 输出中不包含 "task-master" 字样
   - 错误消息显示 "speco-tasker" 而非 "task-master"
   - `bin` 目录中不存在 `task-master.js` 文件
   - `package.json` bin 字段不包含 task-master 相关条目
4.  **给定** 代码库中的AI相关内容（187个文件）， **当** 执行清理， **则** ：
   - 所有AI实现代码被移除且功能保持完整
   - 所有AI相关文档和配置被清理
   - 测试套件经过调整后完全通过
   - 使用综合检索策略清理所有AI相关内容：
     - **品牌关键词**：`task master`、`taskmaster`、`task-master`
     - **AI功能关键词**：`AI`、`ai`、`prompt`、`model`、`claude`、`API_KEY`、`API Key`
     - **功能关键词**：`scope`、`complexity`、`complexityReport`、`research`、`expand`、`prd`、`PRD`、`parse`、`analyze`
     - **探查方式**：结合文件名搜索、内容全文搜索、AST语法分析、依赖关系图分析
5.  **给定** 用户界面文本， **当** 显示信息， **则** ：
   - 0个文件包含 "task-master" 品牌信息（排除历史提交记录）
   - 100%的CLI输出使用 "speco-tasker" 品牌
   - 所有文档和注释已更新为新品牌
6.  **给定** 初始化功能， **当** 使用新的配置系统， **则** ：
   - 项目正确初始化到 `.speco/` 目录
   - 所有初始化文件使用配置化路径
   - 初始化过程无错误且路径正确
7.  **给定** 已初始化的项目， **当** 用户修改配置中的项目目录， **则** ：
   - 系统检测到配置变更并提示用户
   - 提供安全的数据迁移选项
   - 验证新目录权限并确保可写入
   - 成功迁移所有数据文件
   - 提供回滚选项以防迁移失败
8.  **给定** 配置管理命令， **当** 用户通过CLI修改配置参数， **则** ：
   - 验证参数格式和值的合法性
   - 检测与现有配置的潜在冲突
   - 安全地更新配置文件
   - 提供变更历史记录
   - 支持配置的回滚操作
9.  **给定** MCP配置工具， **当** 用户通过集成环境修改配置， **则** ：
   - 实时验证配置参数
   - 提供配置建议和最佳实践
   - 安全地应用配置变更
   - 支持批量配置更新
   - 提供配置状态的实时反馈

### 边界情况

*   **配置文件不存在** → 系统应使用默认路径配置，并自动创建配置文件
*   **已存在的 `.taskmaster/` 目录** → 在此次迭代中无需考虑向后兼容，直接使用新路径
*   **AI相关代码清理不完整** → 可能导致运行时错误或功能异常，需要完整性验证。清理策略必须包含：
    - 多关键词检索（品牌+AI功能+功能关键词+API配置关键词）
    - 多种探查方式（文件名搜索、内容搜索、AST分析、依赖图分析）
    - 渐进式验证（分阶段清理和测试验证）
    - 功能完整性保障（清理后功能测试通过）
    - 关键词覆盖：AI/ai/prompt/model/claude/API_KEY/API Key/prd/PRD/parse/analyze/scope/complexity/research/expand/task master/taskmaster/task-master
*   **品牌信息清理的完整性验证** → 通过系统性搜索和人工检查，确保0个文件包含旧品牌信息
*   **多用户环境下的配置文件权限** → 应正确处理文件权限和共享配置
*   **网络文件系统下的路径兼容性** → 确保路径分隔符在不同操作系统下正确处理
*   **Windows/Unix路径分隔符差异** → 使用path.join等方法确保跨平台兼容
*   **配置文件损坏时的恢复机制** → 提供配置文件自动修复或重置功能
*   **package.json bin字段冲突** → 清理所有task-master相关条目，确保命令一致性
*   **bin目录文件重命名时序** → 协调文件重命名与package.json更新的顺序
*   **使用中修改配置目录** → 用户修改配置中的项目目录可能导致数据访问失败，需提供迁移机制
*   **配置目录变更的数据迁移** → 变更目录后需要安全迁移现有数据文件
*   **目录变更的权限验证** → 确保新目录有足够权限写入数据文件
*   **配置参数格式错误** → 验证配置参数的格式和类型，确保输入合法性
*   **配置冲突检测** → 检测配置变更可能导致的命令冲突或路径冲突
*   **配置历史丢失** → 确保配置变更历史在迁移过程中不丢失
*   **并发配置修改** → 处理多个进程同时修改配置的情况
*   **配置验证失败** → 提供详细的错误信息和修复建议

### 配置管理技术解决方案

#### CLI命令设计

```bash
# 查看当前配置
speco-tasker config show [--format=json|table]

# 修改配置参数
speco-tasker config set <key> <value> [--validate] [--backup]

# 批量配置更新
speco-tasker config update --file=config-updates.json

# 配置验证
speco-tasker config validate [--strict]

# 配置历史
speco-tasker config history [--limit=10]

# 配置回滚
speco-tasker config rollback <version> [--confirm]
```

#### MCP工具设计

```javascript
// 配置查询工具
{
  name: "get_config",
  description: "获取当前配置信息",
  parameters: {
    format: "json|table",
    sections: ["global", "paths", "all"]
  }
}

// 配置修改工具
{
  name: "update_config",
  description: "安全地修改配置参数",
  parameters: {
    key: "配置键名",
    value: "配置值",
    validate: "是否验证配置",
    backup: "是否创建备份"
  }
}

// 配置验证工具
{
  name: "validate_config",
  description: "验证配置参数的合法性",
  parameters: {
    config: "配置对象",
    strict: "是否启用严格验证"
  }
}
```

#### 配置参数结构

```json
{
  "global": {
    "logLevel": "info|debug|warn|error",
    "debug": true|false,
    "defaultNumTasks": 10,
    "defaultPriority": "medium",
    "projectName": "string",
    "userId": "string"
  },
  "paths": {
    "root": ".speco",
    "tasks": ".speco/tasks",
    "config": ".speco/config.json",
    "reports": ".speco/reports",
    "docs": ".speco/docs"
  },
  "features": {
    "enableAutoSave": true|false,
    "enableValidation": true|false,
    "maxHistorySize": 100
  }
}
```

#### 安全机制

1. **参数验证**: 所有配置参数都经过格式和类型验证
2. **冲突检测**: 检查配置变更是否会导致功能冲突
3. **备份机制**: 修改前自动创建配置备份
4. **回滚支持**: 支持配置回滚到历史版本
5. **权限检查**: 验证配置文件和目录的写入权限

## 需求 *(必须)*

### 功能需求

*   **FR-001**: 系统必须建立配置文件来管理所有文件目录路径，避免硬编码路径
*   **FR-002**: 系统必须在路径配置中设置默认目录为 `.speco/`，并支持动态路径切换
*   **FR-003**: 系统必须将CLI命令名称从 `task-master` 更改为 `speco-tasker`，确保100%品牌一致性
*   **FR-004**: 系统必须识别并移除所有残留的AI实现代码（涉及187个文件），确保功能完整性
*   **FR-005**: 系统必须移除所有AI相关的文档和配置内容，包括测试文件和示例
*   **FR-006**: 系统必须在所有用户界面中移除 `task master` 相关品牌信息，实现品牌统一
*   **FR-007**: 系统必须重构初始化功能以使用新的配置系统，支持配置化路径初始化
*   **FR-008**: 系统必须重构迁移功能以支持新的路径配置，确保迁移过程无数据丢失
*   **FR-009**: 系统必须确保所有功能在品牌重塑后保持完整性，包括异常处理和错误恢复
*   **FR-010**: 系统必须清理package.json中所有task-master相关的bin条目，解决命令冲突
*   **FR-011**: 系统必须建立AI相关内容的完整清单和依赖关系图，制定渐进式清理策略，使用综合检索方式识别所有AI相关内容：
    - **品牌关键词检索**：`task master`、`taskmaster`、`task-master`
    - **AI功能关键词检索**：`AI`、`ai`、`prompt`、`model`、`claude`、`API_KEY`、`API Key`
    - **功能关键词检索**：`scope`、`complexity`、`complexityReport`、`research`、`expand`、`prd`、`PRD`、`parse`、`analyze`
    - **多维度探查方式**：文件名搜索、内容全文搜索、AST语法分析、依赖关系图分析
*   **FR-012**: 系统必须建立文件重命名时序协调机制，包括原子性重命名、回滚保障和路径验证，确保bin目录文件重命名与package.json bin字段更新的安全协调
*   **FR-013**: 系统必须检测配置目录变更并提供安全的数据迁移机制
*   **FR-014**: 系统必须在配置变更时验证新目录权限并确保数据完整性
*   **FR-015**: 系统必须提供配置变更的回滚机制以防迁移失败
*   **FR-016**: 系统必须提供安全的CLI命令让用户修改配置参数
*   **FR-017**: 系统必须提供MCP工具让用户通过集成环境修改配置
*   **FR-018**: 系统必须实现配置变更的实时验证和冲突检测

### 关键实体 *(涉及数据配置)*

*   **路径配置实体**: 定义项目中所有文件和目录的路径映射，支持动态路径生成和管理，包含默认路径设置和跨平台兼容性
*   **品牌信息实体**: 包含产品名称、命令名称、描述等品牌相关信息的统一配置，确保100%品牌一致性
*   **初始化配置实体**: 定义项目初始化时使用的路径和配置模板，支持配置化路径初始化
*   **迁移配置实体**: 定义从旧路径结构迁移到新路径结构的规则和映射，确保迁移过程无数据丢失
*   **清理规则实体**: 定义需要清理的AI相关内容和品牌信息的识别规则，支持自动化清理验证
*   **依赖关系图实体**: 建立AI相关内容的完整依赖关系图，用于制定渐进式清理策略。包含多维度检索和分析能力：
    - 基于关键词的依赖追踪（AI/ai/prompt/model/claude/API_KEY/API Key/prd/PRD/parse/analyze/scope/complexity/research/expand）
    - 品牌信息依赖分析（task master/taskmaster/task-master）
    - 文件间引用关系图谱
    - 功能模块依赖链分析
*   **命令协调实体**: 管理bin目录文件重命名与package.json更新的时序协调机制，包括原子性操作、回滚策略和验证规则
*   **验证清单实体**: 定义品牌一致性和功能完整性的自动化验证规则，包括文件存在性检查和命令可用性验证
*   **配置变更检测实体**: 监控配置文件的变更情况，检测路径配置的修改
*   **数据迁移实体**: 定义数据文件从旧路径到新路径的安全迁移规则和流程
*   **配置管理接口实体**: 提供CLI和MCP的配置修改接口，支持参数验证和安全更新
*   **配置验证实体**: 验证配置参数的合法性和一致性，检测潜在冲突
*   **配置历史实体**: 记录配置变更历史，支持回滚和审计

* * *

## 评审与验收清单

*GATE：在 main()执行期间运行自动检查*

### 内容质量

- [x] 不涉及具体实现细节（语言、框架、API）
- [x] 专注于用户价值和业务需求
- [x] 为非技术利益相关者编写
- [x] 所有必填部分已完成

### 需求完整性

- [x] 没有[需要澄清]标记剩余
- [x] 需求是可测试且无歧义的
- [x] 成功标准是可衡量的
- [x] 范围明确界定
- [x] 识别了依赖关系和假设

* * *

## 执行状态

*在处理过程中由 main() 更新*

- [x] 用户描述已解析
- [x] 关键概念已提取
- [x] 重新评估实施顺序
- [x] 建立AI内容影响评估（187个文件）
- [x] 识别package.json冲突问题
- [x] 分析FR-012依赖关系和时序安排
- [x] 评估受影响的功能模块
- [x] 制定实施阶段划分（4个阶段）
- [x] 完善验收标准（6个量化场景）
- [x] 补充边界情况（10个技术场景）
- [x] 建立基础设施保障机制
- [x] 标记的歧义（无）
- [x] 定义的用户场景
- [x] 生成的需求（扩展到12个FR）
- [x] 识别的实体（扩展到8个关键实体）
- [x] 技术风险评估（高/中/低风险分类）
- [x] 审查清单已通过

### 实施阶段划分与依赖关系

**阶段一：基础设施建立与协调机制**
- 建立路径配置文件系统 (FR-001)
- **协调文件重命名时序机制 (FR-012)** *[基础设施保障 - 关键前置条件]*
- 清理package.json冲突 (FR-010) *[依赖FR-012]*
- 建立AI内容清单和依赖关系图 (FR-011)

**阶段二：核心功能实现**
- 在配置中设置.speco/路径 (FR-002)
- **实现命令重命名 (FR-003)** *[强依赖FR-012 - 文件重命名+包配置协调]*
- 重构初始化功能 (FR-007) *[依赖FR-001和FR-012]*
- 重构迁移功能 (FR-008) *[依赖FR-001和FR-012]*

#### 关键依赖关系说明

**FR-012作为基础设施保障机制**：
- **文件系统协调**：确保bin目录文件重命名与package.json bin字段更新的原子性
- **时序控制**：防止重命名过程中出现命令不可用的时间窗口
- **回滚机制**：提供文件重命名失败时的自动回滚能力
- **验证机制**：确保重命名后所有命令路径都正确工作

**依赖FR-012的功能**：
- **FR-003 (命令重命名)**：最直接的依赖者，需要FR-012提供安全的重命名机制
- **FR-010 (package.json清理)**：需要FR-012确保清理和新设置的协调
- **FR-007/FR-008 (初始化/迁移重构)**：需要FR-012确保文件路径引用正确

**阶段三：AI清理执行**
- 移除AI实现代码 (FR-004)
- 移除AI文档和配置 (FR-005)
- 调整测试套件

**阶段四：品牌统一与验证**
- 清理品牌信息 (FR-006)
- 确保功能完整性 (FR-009)
- 执行完整性验证

### 技术风险评估

**高风险项**：
- **AI清理复杂度**：187个文件涉及AI内容，清理不完整可能导致功能失效
- **package.json冲突**：bin字段中task-master条目与新命令冲突
- **文件重命名时序**：bin目录文件重命名与package.json更新需要精确协调

**中风险项**：
- **路径配置兼容性**：多平台路径处理和配置文件权限管理
- **品牌信息遗漏**：系统性搜索可能遗漏某些品牌信息
- **测试套件失效**：AI相关测试移除后需要重新设计

**低风险项**：
- **核心业务逻辑**：任务管理核心功能基本不受影响
- **数据结构**：JSON格式和字段定义保持稳定

### 受影响的功能模块

**高影响模块**：
- **初始化功能**：需要完全重构以使用配置系统
- **迁移功能**：需要更新以支持新的路径配置
- **文件操作模块**：所有路径相关操作需要配置化
- **测试套件**：需要调整AI相关测试和验证逻辑

**中影响模块**：
- **CLI命令系统**：命令名称变更和bin文件管理
- **UI显示系统**：品牌信息清理和用户提示更新
- **配置管理系统**：需要集成路径配置和品牌配置
- **package.json管理**：bin字段清理和依赖管理

**低影响模块**：
- **核心业务逻辑**：任务CRUD操作基本不受影响
- **数据结构**：任务JSON格式和字段定义保持稳定

* * *
