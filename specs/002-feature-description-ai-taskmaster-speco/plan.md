# 实施计划：品牌重塑与AI功能移除

**分支：** `002-feature-description-ai-taskmaster-speco` | **日期：** 2025年1月15日 | **规格：** [链接](specs/002-feature-description-ai-taskmaster-speco/spec.md) 输入：来自 `/Volumes/Data_SSD/Coding/startkits/Speco-Tasker/specs/002-feature-description-ai-taskmaster-speco/spec.md` 的功能规范

## 执行流程 (/plan 命令范围)

```bash
1. 从输入路径加载功能规范
   → 已成功加载 spec.md
2. 填写技术背景（扫描需要澄清的部分）
   → 项目类型：CLI工具，Node.js/JavaScript
   → 技术栈已明确，无需澄清
3. 评估下方的宪法检查部分
   → 检查通过，符合简洁性原则
   → 更新进度跟踪：初始宪法检查
4. 执行阶段 0 → research.md
   → 识别技术风险和解决方案
5. 执行阶段 1 → contracts, data-model.md, quickstart.md
6. 重新评估宪法检查部分
   → 确认设计符合宪法要求
   → 更新进度跟踪：设计后宪法检查
7. 规划阶段 2 → 描述任务生成方法（不要创建 tasks.md）
8. 停止 - 准备执行 /tasks 命令
```

> **重要提示：** /plan 命令在步骤 7 处停止。阶段 2-4 由其他命令执行：

### 第二阶段：/tasks 命令创建 tasks.md
### 第三至四阶段：实施执行（手动或通过工具）

## 总结

品牌重塑与AI功能移除 - 将TaskMaster重塑为Speco Tasker，涉及路径变更、命令重命名、AI清理和品牌统一。主要技术方法包括配置化路径管理、系统性代码清理、安全的文件重命名机制，以及新增的配置管理功能。配置管理提供CLI和MCP接口，让用户能够安全地修改配置参数，支持实时验证、冲突检测和变更历史记录。

### 关键风险与解决方案

- **AI清理复杂度：** 涉及187个文件，采用渐进式清理策略。使用多维度检索方式：
  - **品牌关键词**：`task master`、`taskmaster`、`task-master`
  - **AI功能关键词**：`AI`、`ai`、`prompt`、`model`、`claude`、`API_KEY`、`API Key`
  - **功能关键词**：`scope`、`complexity`、`complexityReport`、`research`、`expand`、`prd`、`PRD`、`parse`、`analyze`
  - **探查方式**：文件名搜索、内容全文搜索、AST语法分析、依赖关系图分析
- **文件重命名时序：** 建立原子性重命名和回滚保障机制
- **配置目录变更：** 实现配置变更检测和安全数据迁移机制
- **版本管理约束：** 开发期间维持1.1.5，需求完成后统一升级至1.2.0

### 实施策略

1. **基础设施优先：** 先建立路径配置系统和文件重命名时序机制
2. **渐进式清理：** AI清理分阶段执行，确保功能完整性。采用多维度检索策略：
   - 第一阶段：基于关键词的文件识别和分类（品牌+AI功能+API配置+功能关键词）
   - 第二阶段：依赖关系图谱建立和影响评估（AI/ai/prompt/model/claude/API_KEY/API Key/prd/PRD/parse/analyze）
   - 第三阶段：渐进式清理和功能验证
   - 第四阶段：完整性验证和回归测试
3. **安全迁移：** 配置变更时提供完整的数据迁移和回滚机制
4. **配置管理：** 实现CLI和MCP的配置管理接口，提供安全配置修改
5. **统一升级：** 所有功能完成后执行版本升级至1.2.0

#### 配置管理实施策略

- **分层架构：** 配置管理分为接口层、验证层、执行层和历史层
- **安全优先：** 所有配置修改都经过验证和备份
- **用户友好：** 提供直观的CLI命令和MCP工具
- **渐进增强：** 从基础配置修改功能开始，逐步增加高级功能

### 版本管理说明

- **当前版本：** 1.1.5
- **目标版本：** 1.2.0 (此次需求完成后升级)
- **版本约束：** 开发期间不可超越 1.2.0 或改变当前版本号
- **升级时机：** 所有功能完成后统一执行版本升级
- **升级类型：** Minor版本升级 (新增功能)

## 技术背景

- **语言/版本：** Node.js/JavaScript (ES2020+)
- **主要依赖：** Commander.js (CLI), fs/promises (文件操作), path (路径处理)
- **存储：** JSON 文件系统 - 本地文件存储，无外部依赖
- **测试：** Jest (单元测试和集成测试)
- **目标平台：** Node.js 运行时环境 (Linux/macOS/Windows)
- **项目类型：** 单一命令行工具 - CLI 应用
- **性能目标：** 路径操作响应时间 < 100ms，命令启动时间 < 500ms
- **限制条件：** 无AI服务依赖，内存使用量减少约30%
- **规模/范围：** 单个CLI工具，核心功能保持完整，涉及187个文件清理
- **版本跃升计划：** 1.1.5 → 1.2.0 (需求完成后统一升级)

## 宪法检查

> **GATE：** 必须在 0 阶段研究前通过。1 阶段设计后重新检查。

### 简洁性

**项目：** [1]（core - 品牌重塑与路径配置）
- **直接使用框架？** 是 - 直接使用 Commander.js, fs, path 等
- **单一数据模型？** 是 - 使用统一的 JSON 配置格式
- **避免模式？** 是 - 简化架构，无复杂设计模式

### 架构

- **每个功能都作为库？** 否 - CLI工具而非库
- **列出的库：** [无 - 单一CLI工具]
- **每个库一个 CLI：** 是 - 单个 speco-tasker 命令
- **库文档：** llms.txt 格式计划好了吗？不适用 - CLI工具

### 测试（不可协商）

- **RED-GREEN-重构周期执行吗？** 是 - 严格遵循TDD
- **Git 提交显示测试在实现之前？** 是
- **顺序：** 合同→集成→端到端→单元是否严格遵循？是
- **是否使用实际依赖（非模拟）？** 是 - 文件系统操作使用实际依赖
- **对新库、合同变更、共享模式进行集成测试？** 是
- **禁止：** 测试前实施，跳过 RED 阶段(已确认)

### 可观察性

- **是否包含结构化日志？** 是 - 使用现有日志系统
- **前端日志 → 后端？** 不适用 - CLI工具
- **错误上下文是否充分？** 是 - 详细错误信息

### 版本控制

- **是否分配了版本号（MAJOR.MINOR.BUILD）？** 是 - 1.1.5 → 1.2.0 (此次需求完成后)
- **每次变更时 BUILD 是否递增？** 是 (开发期间)
- **是否处理了破坏性变更（并行测试、迁移计划）？** 是 - 渐进式实施
- **版本跃升策略：** 此次需求完成后升级至 1.2.0 (minor版本)
- **版本约束：** 开发期间不可超越 1.2.0 或改变当前版本号

## 项目结构

### 文档（此功能）
```
specs/002-feature-description-ai-taskmaster-speco/
├── plan.md              # This file (/plan command output)
├── research.md          # Phase 0 output (/plan command)
├── data-model.md        # Phase 1 output (/plan command)
├── quickstart.md        # Phase 1 output (/plan command)
├── contracts/           # Phase 1 output (/plan command)
└── tasks.md             # Phase 2 output (/tasks command - NOT created by /plan)
```

### 源代码（仓库根目录）

**选项 1: 单项目（默认 - CLI工具）**
```
src/
├── constants/           # 路径常量和配置
├── utils/              # 工具函数
├── ui/                 # 用户界面组件
├── progress/           # 进度跟踪
└── task-master.js      # 主入口

scripts/
├── modules/            # 核心业务逻辑
└── init.js            # 初始化脚本

bin/
├── speco-tasker.js    # 主CLI入口（重命名后）
└── [legacy] task-master.js  # 旧入口（清理）

tests/
├── unit/              # 单元测试
├── integration/       # 集成测试
└── fixtures/          # 测试数据
```

**结构决策：** [选项1 - 单项目CLI工具，符合项目类型和规模]

## 阶段 0：大纲与研究

从上方技术背景中提取未知因素：

- **对于路径配置系统** → 研究最佳实践
- **对于AI内容清理** → 制定清理策略
- **对于文件重命名时序** → 确保原子性操作

### 研究任务
1. 路径配置系统最佳实践研究
2. 大规模AI代码清理策略研究
3. 文件重命名原子性保障机制研究

### 生成并发送研究代理

**For each unknown in Technical Context:**
```
Task: "Research {unknown} for brand rebranding context"
```

**For each technology choice:**
```
Task: "Find best practices for {tech} in Node.js CLI tools"
```

### 使用格式在 research.md 中整合发现

**决策：** [选择的文件系统配置化方案]  
**理由：** [提供灵活性和可维护性]  
**考虑过的替代方案：** [环境变量、数据库配置等，但文件配置更适合CLI工具]

**输出：** research.md，所有 NEEDS CLARIFICATION 问题已解决

## 第一阶段：设计与合同

**前提条件：** research.md 完成

### 从功能规范中提取实体 → data-model.md

#### 路径配置实体
- **字段：** root路径、子目录映射、文件类型映射
- **关系：** 配置文件 → 路径常量 → 运行时路径生成
- **有效性规则：** 路径存在性、权限检查、格式验证
- **状态转换：** 默认配置 → 用户配置 → 运行时路径

#### 品牌信息实体
- **字段：** 产品名称、命令名称、版本信息
- **关系：** 品牌配置 → UI显示 → 用户交互
- **有效性规则：** 非空检查、格式验证、一致性检查

#### 清理规则实体
- **字段：** AI内容标识符、清理策略、验证规则
- **关系：** 清理规则 → 代码扫描 → 清理执行
- **有效性规则：** 误删保护、依赖检查

### 根据功能需求生成 API 合约

#### 核心配置API
- `GET /config/paths` - 获取路径配置
- `PUT /config/paths` - 更新路径配置
- `GET /config/brand` - 获取品牌配置
- `POST /config/cleanup` - 执行清理操作

### 从合约生成合约测试

- 每个端点一个测试文件
- 断言请求/响应模式
- 测试必须失败（尚未实现）

### 从用户故事中提取测试场景

- 每个故事 → 集成测试场景
- 快速启动测试 = 故事验证步骤

### 逐步更新代理文件（O(1)操作）

为您的 AI 助手运行 `/scripts/update-agent-context.sh [claude|gemini|copilot]`
- **如果存在：** 仅添加当前计划中的新技术
- **在标记之间保留手动添加的内容**
- **更新最近更改（保留最后 3 条）**
- **保持在 150 行以内以优化 token 效率**
- **输出到仓库根目录**

**输出：** data-model.md, /contracts/*, 失败的测试, quickstart.md, 特定代理的文件

## 第二阶段：任务规划方法

本节描述了 /tasks 命令将执行的操作 - 在 /plan 期间请勿执行

### 任务生成策略

- 加载 `/templates/tasks-template.md` 作为基础
- 从第一阶段设计文档（合同、数据模型、快速入门）生成任务
- 每个合同 → 合同测试任务 [P]
- 每个实体 → 模型创建任务 [P]
- 每个用户故事 → 集成测试任务
- 实现任务以使测试通过

### 排序策略

- **TDD 顺序：** 测试在实现之前
- **依赖顺序：** 配置在清理之前，清理在重命名之前，配置变更检测贯穿始终
- **标记[P]以并行执行（独立文件）**
- **预计输出：** tasks.md 中包含 30-35 个编号、有序的任务
- **版本管理：** 开发期间维持 1.1.5 版本，需求完成后统一升级至 1.2.0
- **配置变更处理：** 建立配置监听机制，检测目录变更并触发安全迁移

> **重要提示：** 此阶段由/tasks 命令执行，而非/plan 命令

## 阶段 3+：未来实现

这些阶段超出了 /plan 命令的范围

- **阶段 3：** 任务执行 (/tasks 命令创建 tasks.md)
- **阶段 4：** 实施（遵循宪法原则执行 tasks.md）
- **阶段 5：** 验证（运行测试，执行 quickstart.md，性能验证）

## 复杂度跟踪

仅当宪法检查存在必须说明的违规时填写

| 违规 | 为何需要 | 更简单的替代方案被拒绝 |
|------|----------|--------------------------|
| 大规模AI清理 | 涉及187个文件，使用多维度检索策略（品牌+AI功能+API配置+功能关键词+AST分析+依赖图）确保完整性 | 简单搜索替换可能遗漏重要内容，单一检索方式覆盖不全 |
| 文件重命名时序 | 确保原子性和安全性 | 直接重命名可能导致服务中断 |
| 版本管理约束 | 需求完成后统一升级至1.2.0，开发期间维持当前版本 | 分阶段版本升级可能导致版本混乱 |
| 配置目录变更 | 用户修改配置目录需要安全迁移机制 | 直接变更可能导致数据丢失 |
| 配置管理缺失 | 用户无法安全地修改配置参数 | 直接编辑配置文件风险高且不友好 |

## 进度跟踪

这个清单在执行流程中会更新

### 阶段状态

- **阶段 0：** 研究完成 (/plan 命令)
- **阶段 1：** 设计完成 (/plan 命令)
- **第二阶段：** 任务规划完成（/plan 命令 - 仅描述方法）
- **第三阶段：** 任务已生成（/tasks 命令）
- **第四阶段：** 实施完成
- **第五阶段：** 验证通过 + 版本升级至 1.2.0

### 门状态

- **初始结构检查：** 通过
- **设计后结构检查：** 通过
- **所有 NEEDS CLARIFICATION 问题已解决**
- **复杂性偏差已记录**
- **基于宪法 v2.1.1 - 模板推断（constitution.md不存在）**
