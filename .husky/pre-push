#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# è¿è¡Œå®Œæ•´çš„æµ‹è¯•å¥—ä»¶
echo "ğŸ§ª æ­£åœ¨è¿è¡Œå®Œæ•´çš„æµ‹è¯•å¥—ä»¶..."
npm test

# æ£€æŸ¥æ˜¯å¦æœ‰æœªå¤„ç†çš„ changeset
if [ -d ".changeset" ] && [ "$(ls -A .changeset/*.md 2>/dev/null)" ]; then
  echo "âš ï¸  æ£€æµ‹åˆ°æœªå¤„ç†çš„ changeset æ–‡ä»¶"
  echo "   æ¨é€å‰è¯·ç¡®è®¤æ˜¯å¦éœ€è¦è¿è¡Œ 'npm run release' è¿›è¡Œå‘å¸ƒ"
  echo ""
  echo "   å¦‚æœè¿™æ˜¯åŠŸèƒ½å˜æ›´ï¼Œè¯·å…ˆåˆ›å»º changesetï¼š"
  echo "   npm run changeset"
  echo ""
  read -p "æ˜¯å¦ç»§ç»­æ¨é€ï¼Ÿ(y/N): " -n 1 -r
  echo
  if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    echo "æ¨é€å·²å–æ¶ˆ"
    exit 1
  fi
fi

echo "âœ… æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼Œå¯ä»¥æ¨é€"
